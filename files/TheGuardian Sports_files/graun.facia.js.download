(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{278:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var a=n(2),i=n.n(a),o=n(35),r=n(13),s=n(10),c=[],l={top:0,bottom:0},u=function t(){l.top=window.pageYOffset,l.bottom=l.top+i.a.viewport().height,0===(c=c.filter((function(t){return!t.conditionFn()||(t.loadFn(),!1)}))).length&&s.a.off("window:throttledScroll",t)},d=Object(o.a)(u,2e3),h=function(t,e,n){r.a.measure((function(){var a=i()(t);!function(t,e){var n={conditionFn:t,loadFn:e};c.push(n),1===c.length&&s.a.on("window:throttledScroll",u),d()}((function(){var t=a.offset(),n=t.top-e,i=t.top+t.height+e;return l.top>n&&l.bottom<i}),n)}))}},295:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n(21),i=n.n(a),o=n(151),r=function(t){Object(o.a)("flashing-elements")?t&&t():i.a.mutate((function(){document.body&&document.body.classList.add("disable-flashing-elements"),t&&t()}))}},296:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var a=n(18),i=n.n(a),o=n(35),r=n(60),s=function(t,e,n){var a=!1,s={firstview:r.a};return i.a.on(e,"scroll",Object(o.a)((function(){var e=function(t,e){var n=Object.assign({},{left:0,right:0,top:0,bottom:0},e),a=t.getBoundingClientRect(),i=window.innerHeight,o=window.innerWidth,r=a.top+n.top,s=a.bottom-n.bottom,c=a.left-n.left,l=a.right+n.right;return r<i&&s>0&&c<o&&l>0}(t,n);s.firstview&&e&&!a&&(a=!0,s.firstview(t))}),200)),{on:function(t,e){s[t]=e}}}},349:function(t,e){t.exports='<div class="stocks__stock-value <%=deltaClass%>">\n    <div class="stocks__divider"></div>\n    <div class="stocks__name"><%=name%><%=closedInline%></div>\n    <div class="stocks__value">\n        <div class="stocks__price"><%=price%></div>\n        <%=marketDownIcon%>\n        <%=marketUpIcon%>\n        <%=marketSameIcon%>\n        <div class="stocks__change"><%=change%></div>\n    </div>\n    <%=closed%>\n</div>\n'},350:function(t,e){t.exports='<div class="stocks__stocks-container">\n    <%=stocks%>\n</div>\n'},351:function(t,e){t.exports='<a href="<%=href%>" class="fc-item__liveblog-block" data-link-name="block | <%=index%>" aria-hidden="<%=ariaHidden%>">\n    <div class="fc-item__liveblog-block__text">\n        <div class="fc-item__liveblog-block__time"><%=relativeTime%></div>\n        <%=text%>\n    </div>\n</a>\n'},353:function(t,e){t.exports='<section class="flagship-audio__contributions-banner fc-container">\n    <div class="fc-container__inner">\n        <div class="fc-container__header"> </div>\n        <div class="fc-container--rolled-up-hide fc-container__body flagship-audio__contributions-banner-holder">\n            <div class="flagship-audio__contributions-banner-text">\n                <h2>Support The Guardian</h2>\n                <p>Help us deliver the independent\n                    <br> journalism the world needs</p>\n                <a class="contributions__contribute contributions__option-button"\n                   data-link-name="audio-series-contributions"\n                   href="<%= supportContributeURL %>?acquisitionData=%7B%22componentType%22%3A%22ACQUISITIONS_OTHER%22%2C%22source%22%3A%22GUARDIAN_WEB%22%2C%22campaignCode%22%3A%22today_in_focus%22%2C%22componentId%22%3A%22audio_series_page%22%7D&INTCMP=today_in_focus">\n                    Support The Guardian\n                </a>\n            </div>\n            <div class="flagship-audio__contributions-banner-image">\n                <svg xmlns="http://www.w3.org/2000/svg" width="300" height="107"><path d="M0 83.118h12.148v23.824H0zm16.901-36h12.148v59.824H16.901zm16.902-21.177h12.148v81H33.803zm16.901 21.177h12.148v59.824H50.704zM67.606 18h12.148v88.941H67.606zm16.901 41.824h12.148v47.118H84.507zm16.901-12.706h12.148v59.824h-12.148zm16.902-8.471h12.148v68.294H118.31zM135.211 0h12.148v106.941h-12.148zm16.902 49.765h12.148v57.176h-12.148zm16.901-28.059h12.148v85.235h-12.148zm16.901 8.47h12.148v76.765h-12.148zM202.817 0h12.148v106.941h-12.148zm16.901 47.118h12.148v59.824h-12.148zm16.902-21.177h12.148v81H236.62zm16.901-17.47h12.148v98.471h-12.148zm16.902 41.294h12.148v57.176h-12.148zm16.901 33.882h12.148v23.294h-12.148z" fill="#FF6A56"/></svg>\n            </div>\n        </div>\n    </div>\n</section>\n'},419:function(t,e,n){"use strict";n.r(e),n.d(e,"init",(function(){return Jt}));var a=n(31),i=n(0),o=n(11),r=n(10),s=n(133),c=n(295),l=n(25),u=n(22),d=n(149),h=(n(152),n(349),n(350),function(){Object(a.a)(".js-container--first .js-container__header")}),f=n(5),p=n.n(f),v=n(8),m=n.n(v),b=n(57),g=n.n(b),y=n(58),j=n.n(y),_=n(34),w=n.n(_),k=n(44),O=n.n(k),C=n(268),x=n(43);var S=function(t){Object(a.a)(".js-tabs-content",t).addClass("tabs__content--no-border"),Object(a.a)(".js-tabs",t).addClass("u-h")},L=function(t){g()(n,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=w()(t);if(e){var i=w()(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return j()(this,n)}}(n);function n(){var t;return p()(this,n),t=e.call(this),Object(C.a)("most-popular"),t.endpoint="/most-read-geo.json",t.isNetworkFront="Network Front"===i.a.get("page.contentType"),t.isVideoFront="video"===i.a.get("page.pageId"),t.isInternational="international"===i.a.get("page.pageId"),t.manipulationType="html",t}return m()(n,[{key:"prerender",value:function(){this.elem=O()(".headline-list",this.elem)[0]}},{key:"go",value:function(){var t=this.isNetworkFront?".js-tab-1":".js-tab-2";if(this.parent=O()(".js-popular-trails")[0],this.parent)if(this.isInternational&&this.isNetworkFront||this.isVideoFront)S(this.parent);else{var e=this.parent.querySelector(t);e&&this.fetch(e,"html")}}},{key:"ready",value:function(){this.isNetworkFront&&S(this.parent),Object(C.b)("most-popular"),r.a.emit("modules:geomostpopular:ready")}}]),n}(x.a);var $=function(t){g()(n,t);var e=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=w()(t);if(e){var i=w()(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return j()(this,n)}}(n);function n(){var t;return p()(this,n),t=e.call(this),Object(C.a)("most-popular"),t.endpoint="/most-read-geo.json",t.manipulationType="html",t}return m()(n,[{key:"prerender",value:function(){var t="international"===i.a.get("page.pageId");if(this.parent){var e=this.parent.cloneNode(!0),n=O()(".most-popular",this.elem)[0],a=O()(".js-tab-2 .most-popular",e)[0];!t&&n&&a&&a.parentNode&&a.parentNode.replaceChild(n,a);var o=O()(".most-popular__second-tier",this.elem)[0],r=O()(".most-popular__second-tier",e)[0];o&&r&&r.parentNode&&r.parentNode.replaceChild(o,r);var s=O()("#popular-trails",e)[0];s&&(this.elem=s)}}},{key:"go",value:function(){this.parent=O()(".js-popular-trails")[0],this.parent&&this.fetch(this.parent,this.manipulationType)}},{key:"ready",value:function(){"Network Front"===i.a.get("page.contentType")&&(Object(a.a)(".js-tabs-content",this.parent).addClass("tabs__content--no-border"),Object(a.a)(".js-tabs",this.parent).addClass("u-h")),Object(C.b)("most-popular"),r.a.emit("modules:geomostpopular:ready")}}]),n}(x.a),A=n(2),E=n.n(A),T=n(21),D=n.n(T),I=n(69),M="container-states",N={hidden:"Show",displayed:"Hide"},F=function(){function t(e){p()(this,t),this.$container=E()(e),this.$button=E()(E.a.create(function(t){var e=t.text,n=t.dataLink;return'\n    <button class="fc-container__toggle" data-link-name="'.concat(n,'">\n        <span class="fc-container__toggle__text">').concat(e,"</span>\n    </button>\n")}({text:"Hide",dataLink:"Show"}))),this.state="displayed"}return m()(t,[{key:"buttonText",value:function(){return Object(a.a)(".fc-container__toggle__text",this.$button)}},{key:"updatePref",value:function(t){var e=I.a.get(M),n=t;"displayed"===this.state?delete e[n]:(e||(e={}),e[n]="closed"),I.a.set(M,e)}},{key:"setState",value:function(t){var e=this;this.state=t,D.a.mutate((function(){e.$container["displayed"===e.state?"removeClass":"addClass"]("fc-container--rolled-up"),e.$button.attr("data-link-name",N["displayed"===e.state?"hidden":"displayed"]),e.buttonText().text(N[e.state])}))}},{key:"readPrefs",value:function(t){var e=I.a.get(M);e&&e[t]&&this.setState("hidden")}},{key:"addToggle",value:function(){var t=this,e=this.$container.attr("data-id"),n=Object(a.a)(".js-container__header",this.$container[0]);D.a.mutate((function(){n.append(t.$button),t.$container.removeClass("js-container--toggle").removeClass("fc-container--will-have-toggle").addClass("fc-container--has-toggle"),t.readPrefs(e)})),r.a.on("module:clickstream:click",(function(n){n.target===t.$button[0]&&(t.setState("displayed"===t.state?"hidden":"displayed"),t.updatePref(e))}))}}]),t}(),R=n(385),z=n(59),H=Object.freeze({displayed:"displayed",loading:"loading",hidden:"hidden"}),P=function(t,e){var n=I.a.get("section-states",{type:"session"})||{};e!==H.displayed?delete n[t]:n[t]="more",I.a.set("section-states",n,{type:"session"})},q=function(t,e){var n=function(t){return Object(R.a)(O()(".js-fc-item",t),(function(t){return E()(t).attr("data-id")}))}(t),i=E.a.create(e);return Object(a.a)(".js-fc-item",i).each((function(t){var e=E()(t),a=e.attr("class");(e.attr("data-id")in n||Object(z.i)()&&a&&a.includes("paid-content"))&&e.remove()})),i},W=function(){function t(e,n){p()(this,t),this.id=n.attr("data-id"),this.state=function(t){var e=I.a.get("section-states",{type:"session"});return e&&e[t]?H.displayed:H.hidden}(this.id),this.$el=e,this.$container=n,this.isLoaded=!1,this.$iconEl=Object(a.a)(".i",this.$el),this.$placeholder=Object(a.a)(".js-show-more-placeholder",this.$container),this.$textEl=Object(a.a)(".".concat("js-button-text"),this.$el),this.state===H.displayed&&this.loadShowMoreForContainer(),this.messages=new Map([[H.hidden,Object(a.a)(".js-button-text",this.$el).text()],[H.displayed,"Less"],[H.loading,"Loading&hellip;"]])}return m()(t,[{key:"setState",value:function(t){this.$textEl.html(this.messages.get(t)),this.$el.attr("data-link-name",t===H.displayed?"less":"more").toggleClass("button--primary",t!==H.displayed).toggleClass("button--tertiary",t===H.displayed).toggleClass("collection__show-more--loading",t===H.loading),this.$container.toggleClass("fc-show-more--hidden",t!==H.displayed).toggleClass("fc-show-more--visible",t===H.displayed),this.state=t}},{key:"loadShowMoreForContainer",value:function(){var t=this;D.a.mutate((function(){t.setState(H.loading)})),function(t,e){var n="/".concat(t,"/show-more/").concat(e,".json");return function(t,e){return Promise.race([e,new Promise((function(e,n){setTimeout((function(){return n(new Error("Timeout"))}),t)}))])}(5e3,Object(l.a)(n,{mode:"cors"}))}(i.a.get("page.pageId"),this.id).then((function(e){var n,a=e.html.trim();a&&(n=q(t.$container,a)),D.a.mutate((function(){n&&t.$placeholder.replaceWith(n),t.setState(H.displayed),P(t.id,t.state),r.a.emit("modules:show-more:loaded")})),t.isLoaded=!0})).catch((function(e){D.a.mutate((function(){t.setState(H.hidden)})),t.showErrorMessage(),Object(u.a)(e,{feature:"container-show-more"},!1)}))}},{key:"hideErrorMessage",value:function(){var t=this;D.a.mutate((function(){null!=t.$errorMessage&&t.$errorMessage.addClass("show-more__error-message--invisible")}))}},{key:"showErrorMessage",value:function(){var t=this;this.$errorMessage&&this.$errorMessage.remove(),this.$errorMessage=E()(E.a.create('<div class="show-more__error-message">Sorry, failed to load more stories. Please try again.</div>')),D.a.mutate((function(){null!=t.$errorMessage&&(t.$errorMessage.insertAfter(t.$el),setTimeout((function(){t.hideErrorMessage()}),5e3))}))}}]),t}(),U=function(t){D.a.mutate((function(){t.$container.addClass("fc-show-more--hidden").removeClass("js-container--fc-show-more").toggleClass("fc-show-more--hidden",t.state===H.hidden),t.setState(t.state)}))},V=function(){D.a.measure((function(){var t=O()(".js-container--fc-show-more").map(E.a).map((function(t){var e=Object(a.a)(".js-show-more-button",t);return e?new W(e,t):null})).filter((function(t){return null!=t}));t.forEach(U),r.a.on("module:clickstream:click",(function(e){var n=t.find((function(t){return t.$el[0]===e.target}));n&&n.state!==H.loading&&(n.isLoaded?function(t){D.a.mutate((function(){t.setState(t.state===H.hidden?H.displayed:H.hidden),P(t.id,t.state)}))}(n):(n.$errorMessage&&n.$errorMessage.hide(),n.loadShowMoreForContainer()))}))}))},Q=n(134),B=Object(o.f)().height,G=function(t){t.classList.remove("fc-container--lazy-load")},J=function(){var t=O()(".js-container--lazy-load"),e=Object(Q.a)((function(){0===t.length?r.a.off("window:throttledScroll",e):D.a.measure((function(){var e=t.reduce((function(t,e){return t[function(t){var e=t.nextElementSibling,n=e?e.getBoundingClientRect().top:0;return-B<n&&n<2*B}(e)?"in":"out"].push(e),t}),{in:[],out:[]});t=e.out,D.a.mutate((function(){e.in.forEach(G)}))}))}),500);r.a.on("window:throttledScroll",e),e()},X=n(269),K=n(13),Y=n(3),Z=n(352),tt=n(35),et=n(351),nt=n.n(et),at=30,it=5,ot=Object(o.f)().height,rt=function(t){return new Promise((function(e){return setTimeout(e,t)}))},st=function(t,e,n){return K.a.measure((function(){return t.getBoundingClientRect().top})).then((function(e){return!!(e>0&&e<ot)&&(rt(n?0:2e3).then((function(){return K.a.mutate((function(){return t.classList.remove("fc-item__liveblog-blocks__inner--offset")}))})),!0)}))},ct=function(t,e){return K.a.mutate((function(){E()(t).empty().append(e)}))},lt=function(t,e,n){n&&function(t,e){st(t).then((function(e){if(!e){var n=Object(tt.a)((function(){st(t,0,!0).then((function(t){t&&r.a.off("window:throttledScroll",n)}))}),500);r.a.on("window:throttledScroll",n)}})),K.a.mutate((function(){e.classList.remove("fc-item__liveblog-blocks--hidden"),e.classList.add("fc-item__liveblog-blocks--visible")}))}(e[0],t)},ut=function(t,e,n,a){var i=Object(Z.a)(a);e.forEach((function(e){var o=!1,r=["fc-item__liveblog-blocks__inner","u-faux-block-link__promote"],s=n.slice(0,3).map((function(e,n){return!o&&(e.publishedDateTime>a||i)&&(e.isNew=!0,o=!0,r.push("fc-item__liveblog-blocks__inner--offset")),function(t,e,n){var a=function(t){var e=(t||{}).publishedDateTime;return!!e&&Object(X.b)(new Date(e))||""}(e);return a=a.match(/yesterday/i)?a.toLowerCase():a?'<span class="block-time-prefix">Latest update </span>'.concat(a," ago"):'<span class="block-time-prefix">Updated </span>just now',Object(d.a)(nt.a)({ariaHidden:!e.isNew,href:"/".concat(t,"#block-").concat(e.id),relativeTime:a,text:[e.title,e.body.slice(0,500)].filter((function(t){return null!=t})).join(". "),index:n+1})}(t,e,n)})).slice(0,function(t,e){return e?3:t?2:1}(o,function(t){return t.classList.contains("js-liveblog-blocks-dynamic")}(e))),c=E.a.create('<div class="'.concat(r.join(" "),'">').concat(s.join(""),"</div>"));(function(t,e,n){return n?(t.classList.remove("fc-item__liveblog-blocks--visible"),t.classList.add("fc-item__liveblog-blocks--hidden"),rt(150).then((function(){return ct(t,e)}))):ct(t,e)})(e,c,o).then((function(){return lt(e,c,o)}))}))},dt=n(18),ht=n.n(dt),ft=n(278),pt=n(135),vt=["document","fragment","json.html"],mt=[],bt=Object(pt.a)((function(){ht.a.on(window,"message",(function(t){var e,n=mt.find((function(e){return e.contentWindow===t.source}));n&&"set-height"===(e=JSON.parse(t.data)).type&&E()(n).parent().css("height",e.value)}))})),gt=function(t){!function(t,e){var n,a=E()(t),i=[{width:0,name:"tiny"},{width:180,name:"mini"},{width:220,name:"small"},{width:300,name:"medium"},{width:700,name:"large"},{width:940,name:"huge"}];D.a.measure((function(){n=t.offsetWidth})),D.a.mutate((function(){i.map((function(t,a,i){var o=n>=t.width&&(!i[a+1]||n<i[a+1].width);return t.action=o?"addClass":!!e&&"removeClass",t})).filter((function(t){return t.action})).forEach((function(t){a[t.action]("facia-snap-point--"+t.name)}))}))}(t,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),Object(a.a)(t).hasClass("facia-snap--football")&&function(t){if(t&&"mobile"!==Object(o.c)()){var e=E()(t);e.css("height",e.parent().css("height"))}}(t)},yt=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.getAttribute("data-snap-uri");n&&fetch(n,{mode:"cors"}).then((function(t){return t.ok?e?t.json().then((function(t){return t.html})):t.text():Promise.reject(new Error("Fetch error: ".concat(t.statusText)))})).then((function(e){a.a.create(e).each((function(e){D.a.mutate((function(){E()(t).html(e)}))})),Object(X.a)(t)})).catch((function(t){Object(u.a)(t,{feature:"snaps"})}))},jt=function(t){Object(ft.a)(t,1500,(function(){switch(D.a.mutate((function(){E()(t).addClass("facia-snap-embed")})),gt(t),t.getAttribute("data-snap-type")){case"document":!function(t){var e=E()(t).offset(),n=Math.ceil((e.width||0)/2),a=t.getAttribute("data-snap-uri")||"",i=Math.min(Math.max(e.height||0,n),400),o=E.a.create('<div style="width: 100%; height: '.concat(i,'px; overflow: hidden; -webkit-overflow-scrolling:touch"></div>'))[0],r=E.a.create('<iframe src="'.concat(a,'" style="width: 100%; height: 100%; border: none;"></iframe>'))[0];E()(o).append(r),mt.push(r),bt(),D.a.mutate((function(){E()(t).empty().append(o)}))}(t);break;case"fragment":yt(t);break;case"json.html":yt(t,!0)}o.m||r.a.on("window:throttledResize",(function(){gt(t,!0)}))}))},_t=function(t){gt(t),o.m||r.a.on("window:throttledResize",(function(){gt(t,!0)}))},wt=function(){Array.from(document.querySelectorAll(".facia-snap-embed")).forEach(_t),Array.from(document.querySelectorAll(".js-snappable.js-snap")).filter((function(t){var e=Object(a.a)(t).hasClass("facia-snap-embed"),n=t.getAttribute("data-snap-type");return!e&&n&&vt.indexOf(n)>-1})).filter((function(t){return t.getAttribute("data-snap-uri")})).forEach(jt)},kt={13:"enter",38:"up",40:"down",27:"escape"},Ot=function(){function t(e){p()(this,t);var n=e.container;this.apiUrl=e.apiUrl,this.bindElements(n),this.bindEvents(),this.oldQuery="",this.newQuery="",this.inputTmp=""}return m()(t,[{key:"bindElements",value:function(t){this.$list=Object(a.a)(".js-search-tool-list",t),this.$input=Object(a.a)(".js-search-tool-input",t)}},{key:"bindEvents",value:function(){ht.a.on(document.body,"keyup",this.handleKeyEvents.bind(this)),ht.a.on(document.body,"click",this.handleClick.bind(this)),r.a.on("autocomplete:toggle",this.toggleControls.bind(this))}},{key:"hasInputValueChanged",value:function(){return this.oldQuery.length!==this.newQuery.length}},{key:"handleClick",value:function(e){var n=Object(a.a)(e.target).hasClass("js-search-tool-input"),i=t.nearestLinkNode(e.target);n?(e.preventDefault(),r.a.emit("autocomplete:toggle",!0)):i?(e.preventDefault(),Object(a.a)(".active",this.$list).removeClass("active"),Object(a.a)(i).addClass("active"),this.pushData()):r.a.emit("autocomplete:toggle",!1)}},{key:"toggleControls",value:function(t){var e=Object(a.a)(".js-search-tool-input")[0],n=Object(a.a)(".js-search-tool"),i=Object(a.a)(".js-close-location");t?(this.inputTmp=e.value,n.addClass("is-editing"),e.setSelectionRange(0,e.value.length),i.removeClass("u-h")):(n.removeClass("is-editing"),this.clear(),this.setInputValue(this.inputTmp),i.addClass("u-h"))}},{key:"pushData",value:function(){var t=Object(a.a)(".active",this.$list),e="set";if(0===t.length){if(""!==this.$input.val())return;e="remove"}var n={id:t.attr("data-weather-id"),city:t.attr("data-weather-city"),store:e};r.a.emit("autocomplete:fetch",n),this.setInputValue(),this.inputTmp=n.city,this.$input.blur(),setTimeout(this.destroy.bind(this),50)}},{key:"getListOfResults",value:function(t){if(this.newQuery=t.target.value,!t.target.value.match(/\S/))return this.clear(),void(this.oldQuery="");this.hasInputValueChanged()&&this.fetchData()}},{key:"fetchData",value:function(){var t=this;return Object(l.a)("".concat(this.apiUrl).concat(this.newQuery),{mode:"cors"}).then((function(e){t.renderList(e,5),t.oldQuery=t.newQuery})).catch((function(t){Object(u.a)(t,{feature:"search-tool"})}))}},{key:"handleKeyEvents",value:function(t){var e=kt[t.which||t.keyCode];Object(a.a)(t.target).hasClass("js-search-tool-input")&&("down"===e?(t.preventDefault(),this.move(1)):"up"===e?(t.preventDefault(),this.move(-1)):"enter"===e?this.pushData():"escape"===e?this.toggleControls():this.getListOfResults(t))}},{key:"move",value:function(t){var e=Object(a.a)(".active",this.$list),n=parseInt(e.attr("id"),10);Number.isNaN(n)&&(n=-1),e.removeClass("active"),this.getNewId(n+t)<0?this.setInputValue(this.oldQuery):(Object(a.a)("#".concat(this.getNewId(n+t),"sti"),this.$list).addClass("active"),this.setInputValue())}},{key:"getNewId",value:function(t){var e=Object(a.a)("li",this.$list).length,n=t%e;return n<-1?n=e-1:t===e&&(n=-1),n}},{key:"setInputValue",value:function(t){var e=t||Object(a.a)(".active",this.$list).attr("data-weather-city");this.$input.val(e)}},{key:"renderList",value:function(t,e){var n=document.createDocumentFragment();t.slice(0,e).forEach((function(t,e){var a=document.createElement("li");a.className="search-tool__item",a.innerHTML='<a role="button" href="#'.concat(t.id,'"')+' id="'.concat(e,'sti" class="js-search-tool-link search-tool__link').concat(0===e?' active"':'"',' data-link-name="weather-search-tool" data-weather-id="').concat(t.id,'" data-weather-city="').concat(t.city,'">').concat(t.city,' <span class="search-tool__meta">').concat(t.country,"</span></a>"),n.appendChild(a)})),this.clear().append(n)}},{key:"clear",value:function(){return this.$list.html("")}},{key:"destroy",value:function(){this.clear()}}],[{key:"nearestLinkNode",value:function(t){return Object(a.a)(t).hasClass("js-search-tool-link")?t:a.a.ancestor(t,"js-search-tool-link")}}]),t}(),Ct=null,xt=null,St=!1,Lt={init:function(){if(!i.a.get("switches.weather",!1)||!["uk","us","au","international"].includes(i.a.get("page.pageId")))return!1;this.getDefaultLocation()},getUserLocation:function(){var t=I.a.get("weather-location");if(t&&t.id)return t},getWeatherData:function(t){return Object(l.a)(t,{mode:"cors"})},saveUserLocation:function(t){I.a.set("weather-location",{id:t.id,city:t.city})},getDefaultLocation:function(){var t=this,e=this.getUserLocation();return e?this.fetchWeatherData(e):this.getWeatherData("".concat(i.a.get("page.weatherapiurl"),".json")).then((function(e){t.fetchWeatherData(e)})).catch((function(t){Object(u.a)(t,{feature:"weather"})}))},fetchWeatherData:function(t){var e=this,n=i.a.get("page.weatherapiurl"),a=i.a.get("page.edition");return this.getWeatherData("".concat(n,"/").concat(t.id,".json?_edition=").concat(a.toLowerCase())).then((function(n){e.render(n,t.city),e.fetchForecastData(t)})).catch((function(t){Object(u.a)(t,{feature:"weather"})}))},clearLocation:function(){I.a.remove("weather-location"),null!==xt&&xt.setInputValue()},fetchForecastData:function(t){var e=this;return this.getWeatherData("".concat(i.a.get("page.forecastsapiurl"),"/").concat(t.id,".json?_edition=").concat(i.a.get("page.edition").toLowerCase())).then((function(t){e.renderForecast(t)})).catch((function(t){Object(u.a)(t,{feature:"weather"})}))},saveDeleteLocalStorage:function(t){var e=this;"set"===t.store?(this.saveUserLocation(t),this.fetchWeatherData(t).then((function(){return e.toggleForecast()}))):"remove"===t.store&&(this.clearLocation(),this.getDefaultLocation())},bindEvents:function(){var t=this;ht.a.on(document.body,"click",".js-toggle-forecast",(function(e){e.preventDefault(),t.toggleForecast()})),r.a.on("autocomplete:fetch",this.saveDeleteLocalStorage.bind(this))},toggleForecast:function(){Object(a.a)(".weather").toggleClass("is-expanded")},addSearch:function(){xt=new Ot({container:Object(a.a)(".js-search-tool"),apiUrl:i.a.get("page.locationapiurl")})},render:function(t,e){this.attachToDOM(t.html,e),St||(this.bindEvents(),St=!0),null===xt?this.addSearch():xt.bindElements(Object(a.a)(".js-search-tool"))},attachToDOM:function(t,e){Ct=Object(a.a)("#headlines .js-container__header"),Object(a.a)(".js-weather",Ct).remove(),Ct.append(t.replace(new RegExp("<%=city%>","g"),e))},renderForecast:function(t){var e=Object(a.a)(".js-weather-forecast"),n=t.html;e.empty().html(n)}},$t=n(384),At=n(296),Et=n(155),Tt=function(t){if(null!=t){var e=t.querySelector(".youtube-media-atom");if(e){var n=e.getAttribute("data-unique-atom-id");if(n)return Object(Et.b)(n)}}},Dt=function(t,e){return{position:t,atStart:0===t,atEnd:t>=e}},It={NEXT:function(t){var e=t.position>=t.length?t.position:t.position+1;return Tt(document.querySelector(".js-video-playlist-item-".concat(e-1))),Object.assign({},t,Dt(e,t.length))},PREV:function(t){var e=t.position<=0?0:t.position-1;return Tt(document.querySelector(".js-video-playlist-item-".concat(e+1))),Object.assign({},t,Dt(e,t.length))},INIT:function(t){return function(t){Object(o.l)({max:"desktop"})&&(Array.from(t.container.querySelectorAll(".youtube-media-atom iframe")).forEach((function(t){t.remove()})),Array.from(t.container.querySelectorAll(".video-container-overlay-link")).forEach((function(t){t.classList.add("u-faux-block-link__overlay"),t.removeAttribute("tabindex"),t.removeAttribute("aria-hidden")})),Array.from(t.container.querySelectorAll(".youtube-media-atom")).forEach((function(t){t.classList.add("no-player")})))}(t),K.a.measure((function(){Object(a.a)(".js-video-playlist-image",t.container).each((function(e){Object(At.a)(e,Object(a.a)(".js-video-playlist-inner",t.container).get(0),{left:410}).on("firstview",(function(t){K.a.mutate((function(){var e=t.getAttribute("data-src"),n=t.getAttribute("src");e&&!n&&K.a.mutate((function(){t.setAttribute("src",e)}))}))}))}))})),t}},Mt=function(t,e){return It[e.type]?It[e.type](t):t},Nt=function(t){var e=function(t){return{position:0,length:Number(t.getAttribute("data-number-of-videos")),videoWidth:700,container:t}}(t),n=function(t,e){var n=e,a=[],i=function(e){n=t(n,e),a.forEach((function(t){t()}))};return i({type:"INIT"}),{dispatch:i,subscribe:function(t){a.push(t)},getState:function(){return n}}}(Mt,e);!function(t,e){ht.a.on(e,"click",".js-video-playlist-next",(function(){t({type:"NEXT"})})),ht.a.on(e,"keypress",".js-video-playlist-next",(function(e){" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),t({type:"NEXT"}))})),ht.a.on(e,"click",".js-video-playlist-prev",(function(){t({type:"PREV"})})),ht.a.on(e,"keypress",".js-video-playlist-prev",(function(e){" "!==e.key&&"Enter"!==e.key||(e.preventDefault(),t({type:"PREV"}))}))}(n.dispatch,t),n.subscribe((function(){!function(t,e){var n=-t.videoWidth*t.position;K.a.mutate((function(){var i=e.querySelector(".video-playlist__item--active");null!=i&&(i.classList.remove("video-playlist__item--active"),Object(a.a)(".youtube-media-atom__iframe",i).hide(),Object(a.a)(".video-overlay .fc-item__link",i).attr("tabindex","-1"),Object(a.a)(".video-overlay .fc-item__link",i).attr("aria-hidden","true"));var o=e.querySelector(".js-video-playlist-item-".concat(t.position));null!=o&&(o.classList.add("video-playlist__item--active"),Object(a.a)(".youtube-media-atom__iframe",o).show(),Object(a.a)(".video-overlay .fc-item__link",o).removeAttr("tabindex"),Object(a.a)(".video-overlay .fc-item__link",o).removeAttr("aria-hidden")),e.classList.remove("video-playlist--end","video-playlist--start"),t.atStart?(e.classList.add("video-playlist--start"),Object(a.a)(".video-title__link",e).removeAttr("tabindex"),Object(a.a)(".video-title__link",e).removeAttr("aria-hidden"),Object(a.a)(".treats__treat",e).removeAttr("tabindex"),Object(a.a)(".treats__treat",e).removeAttr("aria-hidden"),Object(a.a)(".js-video-playlist-prev",e).attr("aria-hidden","true"),Object(a.a)(".js-video-playlist-prev",e).attr("tabindex","-1")):(Object(a.a)(".video-title__link",e).attr("tabindex","-1"),Object(a.a)(".video-title__link",e).attr("aria-hidden","true"),Object(a.a)(".treats__treat",e).attr("tabindex","-1"),Object(a.a)(".treats__treat",e).attr("aria-hidden","true"),Object(a.a)(".js-video-playlist-prev",e).removeAttr("aria-hidden"),Object(a.a)(".js-video-playlist-prev",e).attr("tabindex","0")),t.atEnd?(e.classList.add("video-playlist--end"),Object(a.a)(".js-video-playlist-next",e).attr("aria-hidden","true"),Object(a.a)(".js-video-playlist-next",e).attr("tabindex","-1")):(Object(a.a)(".js-video-playlist-next",e).removeAttr("aria-hidden"),Object(a.a)(".js-video-playlist-next",e).attr("tabindex","0")),function(t,e){Object(a.a)(".js-video-playlist-image--".concat(e),t).each((function(t){K.a.measure((function(){var e=t.getAttribute("data-src"),n=t.getAttribute("src");return e&&!n?e:null})).then((function(e){e&&K.a.mutate((function(){t.setAttribute("src",e)}))}))}))}(e,t.position+1);var r=e.querySelector(".js-video-playlist-item-".concat(t.position));null!=r&&r.classList.add("video-playlist__item--active");var s=e.querySelector(".js-video-playlist-inner");null!=s&&s.setAttribute("style","-webkit-transform: translate(".concat(n,"px);")+"transform: translate(".concat(n,"px);"))}))}(n.getState(),t)})),Object(a.a)(".video-playlist__item:not(.video-playlist__item--first)").each((function(t){Object(a.a)(".youtube-media-atom__iframe",t).hide(),Object(a.a)(".video-overlay .fc-item__link",t).attr("tabindex","-1"),Object(a.a)(".video-overlay .fc-item__link",t).attr("aria-hidden","true")}))},Ft=n(353),Rt=n.n(Ft),zt=n(284),Ht=function(){wt(),r.a.on("modules:container:rendered",wt)},Pt=function(){r.a.addListeners({"modules:container:rendered":V,"page:front:ready":V})},qt=function(){var t=function(t){Object(a.a)(".js-container--toggle",Object(a.a)(t||document)[0]).each((function(t){new F(t).addToggle()}))};r.a.addListeners({"page:front:ready":t,"modules:geomostpopular:ready":Object($t.a)(t,".js-popular-trails")})},Wt=function(){i.a.get("switches.geoMostPopular")&&(i.a.get("switches.extendedMostPopularFronts")?(new $).go():(new L).go())},Ut=function(){i.a.get("switches.weather")&&r.a.on("page:front:ready",(function(){Lt.init()}))},Vt=function(){Object(o.l)({min:"desktop"})&&r.a.on("page:front:ready",(function(){!function t(){return K.a.measure((function(){var t=new Map;return Object(a.a)(".js-liveblog-blocks").each((function(e){var n=e.getAttribute("data-article-id");if(n){var a=t.get(n)||[];a.push(e),t.set(n,a)}})),t})).then((function(e){var n;e.size&&(n=Y.a.session.get("gu.liveblog.block-dates")||{},e.forEach((function(t,e){Object(l.a)("/".concat(e,".json?rendered=false"),{mode:"cors"}).then((function(a){var i=a&&function(t){return t.filter((function(t){return t.id&&t.publishedDateTime&&t.body&&t.body.length>=10}))}(a.blocks);i&&i.length&&(ut(e,t,i,n[e]),n[e]=i[0].publishedDateTime,Y.a.session.set("gu.liveblog.block-dates",n))})).catch((function(){}))})),it&&(it-=1,setTimeout((function(){t()}),1e3*at),at*=1))}))}()}))},Qt=function(){Object(a.a)(".js-video-playlist").each((function(t){Nt(t)}))},Bt=function(){r.a.emit("page:front:ready")},Gt=function(){Object(a.a)("#flagship-audio").length>0&&function(){var t=document.querySelectorAll("section.fc-container--tag");t.length>=5&&function(t){var e=Object(d.a)(Rt.a)({supportContributeURL:Object(zt.b)()});K.a.mutate((function(){t.insertAdjacentHTML("afterend",e)}))}(t[4])}()},Jt=function(){Object(s.b)([["f-accessibility",c.a],["f-snaps",Ht],["f-show-more",Pt],["f-container-toggle",qt],["f-geo-most-popular",Wt],["f-lazy-load-containers",J],["f-stocks",h],["f-weather",Ut],["f-live-blog-updates",Vt],["f-video-playlists",Qt],["f-audio-flagship-contributions",Gt],["f-finished",Bt]])}}}]);
//# sourceMappingURL=graun.facia.js.map